---
title: "firebase vue CD"
emoji: "ğŸ•"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["firebase", "vue"]
published: true
---

## ã¯ã˜ã‚ã«

ãƒªãƒ³ã‚¿ãƒ¼ã€ãƒ†ã‚¹ãƒˆã®ç®‡æ‰€ã¯ã€ä¸€æ—¦ãŠã„ã¦ãŠã
firebase ã«ãŠã‘ã‚‹è‡ªå‹• CD ã‚’æ§‹ç¯‰ã™ã‚‹ã¾ã§ã‚’è¨˜è¿°ã—ã¦ãŠã

## ä¸‹æº–å‚™

### ç’°å¢ƒ

gitï¼šgithub
docker-imageï¼šnode:24.7-bookworm-slim
vueï¼š3.5.18

### ãƒªãƒã‚¸ãƒˆãƒªä½œæˆ

github ã§ä½œæˆ

ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«ã™ã‚‹ã€ã¨ github actions ã§ãŠé‡‘ã‹ã‹ã‚‹(ä½¿ã„ã™ãã‚‹ã¨)ã®ã§ã¨ã‚Šã‚ãˆãš public

### ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

```
npm create vite@latest

Need to install the following packages:
create-vue@3.18.0
Ok to proceed? (y) y


> npx
> "create-vue"

â”Œ  Vue.js - The Progressive JavaScript Framework
â”‚
â—‡  Project name (target directory):
â”‚  front
â”‚
â—‡  Select features to include in your project: (â†‘/â†“ to navigate, space to select, a to toggle all, enter to confirm)
â”‚  TypeScript, Router (SPA development), Pinia (state management)
â”‚
â—‡  Select experimental features to include in your project: (â†‘/â†“ to navigate, space to select, a to toggle all, enter to confirm)
â”‚  none
â”‚
â—‡  Skip all example code and start with a blank Vue project?
â”‚  No
```

## firebase

### firebase CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã‚Šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã—ãŸã‚Šã™ã‚‹ãŸã‚

```
npm install firebase-tools
```

### ãƒ­ã‚°ã‚¤ãƒ³

å®Ÿè¡Œã™ã‚‹ã¨ãƒ–ãƒ©ã‚¦ã‚¶ã«é£›ã³ã€ãƒ­ã‚°ã‚¤ãƒ³ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ãŸã‚ã€æµã‚Œã«æ²¿ã„ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹

```
firebase login
```

### hosting service ã®è¨­å®š

```
firebase init hosting
```

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã™ã‚‹

```

=== Project Setup

First, let's associate this project directory with a Firebase project.
You can create multiple project aliases by running firebase use --add,
but for now we'll just set up a default project.

```

ä»Šå›ã¯ã€æ—¢ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ã„ãŸã®ã§ã€ãã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ

```
âœ” Please select an option: Use an existing project
âœ” Select a default Firebase project for this directory: {ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã—ãŸã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå}
```

ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®è¨­å®š

```
=== Hosting Setup

Your public directory is the folder (relative to your project directory) that
will contain Hosting assets to be uploaded with firebase deploy. If you
have a build process for your assets, use your build's output directory.
```

å…¬é–‹ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é¸æŠ
vue ã‚’ vite ã§ãƒ“ãƒ«ãƒ‰ã—ãŸéš›ã€/dist ã«ãƒ“ãƒ«ãƒ‰ç‰©ãŒå‡ºåŠ›ã•ã‚Œã‚‹ãŸã‚ dist ã‚’é¸æŠ

```
âœ” What do you want to use as your public directory? dist
```

vue ã¯ã€SPA ãªã®ã§ yes

```
âœ” Configure as a single-page app (rewrite all urls to /index.html)? Yes
```

ä¸€ã¤ãšã¤è¨­å®šã—ã¦ã¿ãŸã‹ã£ãŸã®ã§ã€ã¨ã‚Šã‚ãˆãš No

```
âœ” Set up automatic builds and deploys with GitHub? No
```

index.html ã‚’ä½œæˆã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ãŒã‚‚ã†æ—¢ã«ãƒ“ãƒ«ãƒ‰ã—ã¦ã„ãŸã®ã§ã€ä¸Šæ›¸ãã—ãªã„

```
âœ” File dist/index.html already exists. Overwrite? No
i Skipping write of dist/index.html

âœ” Wrote configuration info to firebase.json
âœ” Wrote project information to .firebaserc

âœ” Firebase initialization complete!
```

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ä½œæˆã•ã‚ŒãŸ **firebase.json** ã¨ **.firebaserc**ã«ã¤ã„ã¦

### firebaserc

- Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã®å¯¾å¿œä»˜ã‘æƒ…å ±ã‚’ä¿æŒ
- CLI ã§ firebase deploy ã‚„ firebase serve ã‚’ã—ãŸã¨ãã«ã€ã©ã® Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸æ“ä½œã™ã‚‹ã‹ã‚’æ±ºã‚ã‚‹(é–‹ç™ºã¨æœ¬ç•ªã‚’åˆ†ã‘ã‚Œã‚‹)

### firebase.json

- Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- Hostingãƒ»Functionsãƒ»Databaseãƒ»Emulators ãªã©ã€Firebase ã®ã‚µãƒ¼ãƒ“ã‚¹ã”ã¨ã®è¨­å®šã‚’æ›¸ã‘ã‚‹

## ãƒ‡ãƒ—ãƒ­ã‚¤

### ãƒ“ãƒ«ãƒ‰

```
npm run build
```

### hosting ã¸ãƒ‡ãƒ—ãƒ­ã‚¤

```
firebase deploy --only hosting
```

## ãƒ‡ãƒªãƒãƒªãƒ¼

ãƒ‡ãƒ—ãƒ­ã‚¤ã®è‡ªå‹•åŒ–

### github é€£æº

PR ç”¨ã¨ main ãƒãƒ¼ã‚¸ç”¨ã® 2 ã¤ã® GitHub Actions ãŒè‡ªå‹•ç”Ÿæˆ

```
firebase init hosting:github
```

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

- .github/workflows/firebase-hosting-pull-request.ymlï¼ˆPR ç”¨ï¼‰
- .github/workflows/firebase-hosting-merge.ymlï¼ˆmain ãƒãƒ¼ã‚¸ç”¨ï¼‰

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šï¼ˆPR ç”¨ï¼‰

è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å°‘ã—ä»˜ã‘åŠ ãˆ

```yml
# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

# Actions ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¸ãƒ§ãƒ–ã®åå‰
name: Deploy to Firebase Hosting on PR
# PRï¼ˆPull Requestï¼‰ãŒä½œæˆ/æ›´æ–°/å†ã‚ªãƒ¼ãƒ—ãƒ³ã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œ
on: pull_request
# GitHub ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¨©é™è¨­å®š
permissions:
  # ãƒã‚§ãƒƒã‚¯çµæœï¼ˆæˆåŠŸ/å¤±æ•—ï¼‰ã‚’æ›¸ãè¾¼ã‚ã‚‹
  checks: write
  # ãƒªãƒã‚¸ãƒˆãƒªã®å†…å®¹ã‚’èª­ã¿è¾¼ã‚ã‚‹
  contents: read
  # Pull Request ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ãè¾¼ã‚ã‚‹
  pull-requests: write
  # ã‚¸ãƒ§ãƒ–å®šç¾©
jobs:
  # ã‚¸ãƒ§ãƒ–å
  build_and_preview:
    # PR ã®ä½œæˆå…ƒãŒåŒã˜ãƒªãƒã‚¸ãƒˆãƒªã®ã¨ãã ã‘å®Ÿè¡Œ
    if: ${{ github.event.pull_request.head.repo.full_name == github.repository }}
    # å®Ÿè¡Œç’°å¢ƒ(ãƒ©ãƒ³ãƒŠãƒ¼)
    runs-on: ubuntu-latest
    # ã‚¹ãƒ†ãƒƒãƒ—å®šç¾©
    steps:
      # ãƒªãƒã‚¸ãƒˆãƒªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒ©ãƒ³ãƒŠãƒ¼ã¸ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ(å–å¾—)
      - name: Checkout code
        uses: actions/checkout@v4
      # GitHub Actionsï¼ˆCI ç’°å¢ƒï¼‰ã§ Node.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾å­˜ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install dependencies
        run: npm ci
        working-directory: front
      # front ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ npm run build ã‚’å®Ÿè¡Œ
      - name: Build project
        run: npm run build
        working-directory: front # front/ã«package.jsonãŒã‚ã‚‹ãŸã‚
      # Firebase Hosting ã¸ãƒ‡ãƒ—ãƒ­ã‚¤
      - name: Deploy to Firebase Hosting
        uses: FirebaseExtended/action-hosting-deploy@v0
        # action-hosting-deploy ã®è¨­å®š
        with:
          # GitHub ãƒˆãƒ¼ã‚¯ãƒ³
          repoToken: GitHub ãƒˆãƒ¼ã‚¯ãƒ³
          # Firebase ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç§˜å¯†éµ
          firebaseServiceAccount: Firebase ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç§˜å¯†éµ
          # ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãƒãƒ£ãƒãƒ«ï¼ˆchannelId: pr-<PRç•ªå·> ã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒï¼‰
          channelId: pr-${{ github.event.pull_request.number }}
          # Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ID
          projectId: projectId
          # ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
          entryPoint: ./front
```

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šï¼ˆmain ãƒãƒ¼ã‚¸ç”¨ï¼‰

```yml
# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

# Actions ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¸ãƒ§ãƒ–ã®åå‰
name: Deploy to Firebase Hosting on merge
# main ãƒ–ãƒ©ãƒ³ãƒã¸ pushï¼ˆãƒãƒ¼ã‚¸ï¼‰ã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œ
on:
  push:
    branches:
      - main
permissions:
  # ãƒã‚§ãƒƒã‚¯çµæœï¼ˆæˆåŠŸ/å¤±æ•—ï¼‰ã‚’æ›¸ãè¾¼ã‚ã‚‹
  checks: write
  # ãƒªãƒã‚¸ãƒˆãƒªã®å†…å®¹ã‚’èª­ã¿è¾¼ã‚ã‚‹
  contents: read
  # Pull Request ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ãè¾¼ã‚ã‚‹
  pull-requests: write
jobs:
  # ã‚¸ãƒ§ãƒ–å
  build_and_deploy:
    # å®Ÿè¡Œç’°å¢ƒ(ãƒ©ãƒ³ãƒŠãƒ¼)
    runs-on: ubuntu-latest
    # ã‚¹ãƒ†ãƒƒãƒ—å®šç¾©
    steps:
      # ãƒªãƒã‚¸ãƒˆãƒªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒ©ãƒ³ãƒŠãƒ¼ã¸ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ(å–å¾—)
      - name: Checkout code
        uses: actions/checkout@v4
        # GitHub Actionsï¼ˆCI ç’°å¢ƒï¼‰ã§ Node.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾å­˜ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install dependencies
        run: npm ci
        working-directory: front
      # front ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ npm run build ã‚’å®Ÿè¡Œ
      - name: Build project
        run: npm run build
        working-directory: front # front/ã«package.jsonãŒã‚ã‚‹ãŸã‚
      # Firebase Hosting ã¸ãƒ‡ãƒ—ãƒ­ã‚¤
      - name: Deploy to Firebase Hosting
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          # GitHub ãƒˆãƒ¼ã‚¯ãƒ³
          repoToken: GitHub ãƒˆãƒ¼ã‚¯ãƒ³
          # Firebase ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç§˜å¯†éµ
          firebaseServiceAccount: Firebase ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç§˜å¯†éµ
          # ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãƒãƒ£ãƒãƒ«ï¼ˆchannelId: live ã¯æœ¬ç•ªç’°å¢ƒï¼‰
          channelId: live
          # Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ID
          projectId: projectId
          # ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
          entryPoint: ./front
```

### GitHub Actions ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ YAML

### `uses:`

- **æ„å‘³**ï¼šæ—¢å­˜ã®ã€Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå†åˆ©ç”¨ã§ãã‚‹å‡¦ç†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰ã€ã‚’å‘¼ã³å‡ºã™
- **å ´æ‰€**ï¼š`steps:` ã®ä¸­ã§ä½¿ã†

ä¾‹ï¼š

```yaml
- uses: actions/checkout@v4
```

ã“ã‚Œã¯ã€ŒGitHub ãŒæä¾›ã™ã‚‹ checkout ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã® v4 ã‚’å®Ÿè¡Œã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã€‚
ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€ãƒªãƒã‚¸ãƒˆãƒªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ runnerï¼ˆå®Ÿè¡Œç’°å¢ƒï¼‰ã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆï¼ˆã‚³ãƒ”ãƒ¼ï¼‰ã™ã‚‹ã€‚

ã»ã‹ã®ä¾‹ï¼š

```yaml
- uses: actions/setup-node@v4
```

Node.js ã®ç’°å¢ƒã‚’æº–å‚™ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã€‚

---

### `run:`

- **æ„å‘³**ï¼šã‚·ã‚§ãƒ«ã‚³ãƒãƒ³ãƒ‰ã‚’ãã®ã¾ã¾å®Ÿè¡Œã™ã‚‹
- **å ´æ‰€**ï¼š`steps:` ã®ä¸­ã§ä½¿ã†

ä¾‹ï¼š

```yaml
- run: npm ci
  working-directory: front
```

ğŸ‘‰ runner ã®ã‚·ã‚§ãƒ«ã§ `npm ci` ã‚’å®Ÿè¡Œã€‚`working-directory: front` ãŒã‚ã‚‹ã®ã§ `front/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œã•ã‚Œã‚‹ã€‚

---

### `with:`

- **æ„å‘³**ï¼š`uses:` ã§å‘¼ã³å‡ºã—ãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã« **å¼•æ•°ï¼ˆè¨­å®šå€¤ï¼‰** ã‚’æ¸¡ã™
- **å ´æ‰€**ï¼š`uses:` ã®ç›´ä¸‹ã«æ›¸ã

ä¾‹ï¼š

```yaml
- uses: actions/setup-node@v4
  with:
    node-version: "20"
    cache: "npm"
```

`setup-node` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã€ŒNode ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 20ã€ã€Œnpm ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ã†ã€ã¨ã„ã†è¨­å®šã‚’æ¸¡ã—ã¦ã„ã‚‹ã€‚

ã‚‚ã† 1 ã¤ä¾‹ï¼š

```yaml
- uses: FirebaseExtended/action-hosting-deploy@v0
  with:
    repoToken: ${{ secrets.GITHUB_TOKEN }}
    firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
    projectId: ci-cd-test-79507
```
